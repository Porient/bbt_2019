<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbt.back.dao.RecordDao">
    <resultMap id="recordMap" type="com.bbt.back.entities.Record">
        <id column="record_id" property="recordId" />
        <result column="user_id" property="userId" />
        <result column="product_id" property="productId" />
        <result column="product_type" property="productType" />
        <result column="product_name" property="productName" />
        <result column="product_picture" property="productPicture" />
        <result column="browse_time" property="browseTime" />
    </resultMap>

    <delete id="deleteRecord" parameterType="java.lang.Integer">
      delete from `record`
      where record_id = #{recordId}
    </delete>

    <insert id="insertRecord" parameterType="com.bbt.back.entities.Record">
      insert into `record` (user_id, product_id,  product_Type, product_name, product_picture, browse_time)
      values (#{userId}, #{productId}, #{productType}, #{productName}, #{productPicture}, #{browseTime})
    </insert>

    <update id="updateRecord" parameterType="com.bbt.back.entities.Record">
        update `record`
        <set>
            <if test="userId != null and userId != ''"> user_id = #{userId},</if>
            <if test="productId != null and productId != ''"> product_id = #{productId},</if>
            <if test="productType != null and productType != ''"> product_type = #{productType},</if>
            <if test="productName != null and productName != ''"> product_name = #{productName},</if>
            <if test="productPicture != null and productPicture != ''"> product_picture = #{productPicture},</if>
            <if test="browseTime != null and browseTime != ''"> browse_time = #{browseTime}</if>
        </set>
        where record_id = #{recordId}
    </update>

    <select id="findRecordById" parameterType="java.lang.Integer" resultMap="recordMap">
      select r.*
      from `record` r
      where r.record_id = #{recordId}
    </select>

    <select id="selectAll" parameterType="java.lang.Integer" resultMap="recordMap">
      select r.*
      from `record` r
    </select>

    <select id="selectByUserId" parameterType="java.lang.Integer" resultMap="recordMap">
      select r.*
      from `record` r
      where r.user_id = #{userId}
    </select>

    <select id="findRecordNumByUserId" parameterType="java.lang.Integer" resultType="java.lang.Long">
      select count(*)
      from `record` r
      where r.user_id = #{userId}
    </select>

    <select id="findProductNumByUserIdAndType" parameterType="java.lang.Integer" resultType="java.lang.Integer">
      select count(*)
      from `record` r
      where r.user_id = #{userId} AND
      r.product_type = #{productType}
    </select>

    <select id="sumByUserIdList" resultType="java.util.HashMap">
        SELECT record_id as 'key', count(*) as 'value'
        FROM record
        where user_id=#{userId};
    </select>

    <select id="sumByTimeList" resultType="java.util.HashMap">
        SELECT DATE_FORMAT(browse_time,'%Y-%m-%d') as 'key', count(*) as 'value'
        FROM record
        GROUP BY 'key';
    </select>
</mapper>